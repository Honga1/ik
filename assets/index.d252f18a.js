var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,i=(e,i)=>{for(var a in i||(i={}))n.call(i,a)&&o(e,a,i[a]);if(t)for(var a of t(i))r.call(i,a)&&o(e,a,i[a]);return e};import{r as a,u as l,V as s,B as c,L as u,C as m,a as f,R as h,c as p,b as g,O as E,H as d,d as v,e as b,f as w}from"./vendor.bb499e6b.js";var x=function(e,t){var n=e[1],r=e[2],o=e[3],i=e[0],a=t[1],l=t[2],s=t[3],c=t[0];return[i*c-n*a-r*l-o*s,n*c+i*a+r*s-o*l,r*c+i*l+o*a-n*s,o*c+i*s+n*l-r*a]},M=function(e){var t=e[0],n=e[1],r=e[2],o=Math.cos,i=Math.sin,a=o(t/2),l=o(n/2),s=o(r/2),c=i(t/2),u=i(n/2),m=i(r/2);return[a*l*s-c*u*m,c*l*s+a*u*m,a*u*s-c*l*m,a*l*m+c*u*s]},k=function(e,t,n){for(var r=new Array(2),o=0;o<2;o++){var i=e[o],a=t[o];r[o]=n(i,a)}return B(r)},y=function(e){return Math.pow(function(e){return Math.pow(e[0],2)+Math.pow(e[1],2)}(e),.5)},P=function(e,t){var n=k(e,t,(function(e,t){return e-t}));return y(n)},B=function(e){if(2!==e.length)throw new Error("Cannot create V2 from "+e+", length is "+e.length+". Length should be 2");return e},R=function(e,t){return r=t,o=(n=[e,0])[0],i=n[1],a=Math.cos(r),l=Math.sin(r),[o*a-i*l,o*l+i*a];var n,r,o,i,a,l},I=function(e){return e[0]+e[1]+e[2]},S=function(e){return Math.pow(function(e){return I((n=e,[(t=e)[0]*n[0],t[1]*n[1],t[2]*n[2]]));var t,n}(e),.5)},G=function(e,t){var n,r,o=(r=t,[(n=e)[0]-r[0],n[1]-r[1],n[2]-r[2]]);return S(o)},q=function(e){if(3!==e.length)throw new Error("Cannot create V3 from "+e+", length is "+e.length+". Length should be 3");return e},A=function(e,t){return n=[e,0,0],i=[(o=r=t)[0],-o[1],-o[2],-o[3]],a=x(r,function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([0],n)),x(a,i).slice(1);var n,r,o,i,a};function C(e,t,n,r){var o,i,a,l=null!==(o=null==r?void 0:r.deltaAngle)&&void 0!==o?o:1e-5,s=null!==(i=null==r?void 0:r.learningRate)&&void 0!==i?i:1e-4,c=null!==(a=null==r?void 0:r.acceptedError)&&void 0!==a?a:0,u=F(e,{position:t,rotation:0}),m=u.transforms,f=u.effectorPosition,h=P(n,f);if(!(h<c)){if(m.length!==e.length+1)throw new Error("Joint transforms should have the same length as links + 1. Got "+m.length+", expected "+e.length);e.map((function(t,r){var o=j(function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([{length:t.length,rotation:t.rotation+l}],e.slice(r+1)),m[r],n);return{link:t,angleStep:-((o-h)/l)*("function"==typeof s?s(o):s)}})).forEach((function(e){var t=e.link,n=e.angleStep;if(t.rotation+=n,void 0!==t.constraint){var r,o,i,a=t.constraint/2;t.rotation=(r=t.rotation,o=-a,i=a,Math.min(Math.max(o,r),i))}}))}}function j(e,t,n){var r=function(e,t){return F(e,t).effectorPosition}(e,t);return P(n,r)}function F(e,t){for(var n,r,o=[t],i=0;i<e.length;i++){var a=e[i],l=o[i],s=a.rotation+l.rotation,c=R(a.length,s),u=(n=c,r=l.position,k(n,r,(function(e,t){return e+t})));o.push({position:u,rotation:s})}return{transforms:o,effectorPosition:o[o.length-1].position}}function O(e,t,n){var r=function(e,t){return D(e,t).effectorPosition}(e,t);return G(n,r)}function D(e,t){for(var n,r,o=[t],i=0;i<e.length;i++){var a=e[i],l=o[i],s=x(l.rotation,a.rotation),c=A(a.length,s),u=(n=c,r=l.position,[n[0]+r[0],n[1]+r[1],n[2]+r[2]]);o.push({position:u,rotation:s})}return{transforms:o,effectorPosition:o[o.length-1].position}}const N=({link:e,child:t})=>{const n=a.exports.useRef(),r=a.exports.useRef();l((()=>{n.current&&r.current&&(n.current.quaternion.set(e.rotation[1],e.rotation[2],e.rotation[3],e.rotation[0]),r.current.position.set(e.length,0,0))}));const o=a.exports.useMemo((()=>{const t=[new s,new s(e.length,0,0)],n=(new c).setFromPoints(t),r=new u({color:new m("#8B008B")});return new f(n,r)}),[e.length]);return h.createElement("group",{ref:n},h.createElement("mesh",{ref:r},h.createElement("sphereBufferGeometry",{args:[20,8,8]}),h.createElement("meshStandardMaterial",{transparent:!0,wireframe:!0}),t&&h.createElement(N,i({},t))),h.createElement("primitive",{object:o}))},H=({position:e,sequence:t,target:n})=>{const r=a.exports.useRef(),o=a.exports.useMemo((()=>function(e){let t;for(let n=e.length-1;n>=0;n--){const r={link:e[n]};void 0!==t?t={link:r.link,child:t}:t=r}return t}(t)),[t]);return l((()=>{r.current&&(r.current.position.set(...e),function(e,t,n,r){var o,i,a,l=null!==(o=null==r?void 0:r.deltaAngle)&&void 0!==o?o:1e-5,s=null!==(i=null==r?void 0:r.learningRate)&&void 0!==i?i:1e-4,c=null!==(a=null==r?void 0:r.acceptedError)&&void 0!==a?a:0,u=D(e,{position:t,rotation:[1,0,0,0]}),m=u.transforms,f=u.effectorPosition,h=G(n,f);if(!(h<c)){if(m.length!==e.length+1)throw new Error("Joint transforms should have the same length as links + 1. Got "+m.length+", expected "+e.length);e.map((function(t,r){var o=q([0,0,0].map((function(o,i){var a=[0,0,0];a[i]=l;var c=O(function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([{length:t.length,rotation:x(t.rotation,M(q(a)))}],e.slice(r+1)),m[r],n);return-(c-h)/l*("function"==typeof s?s(c):s)})));return{link:t,angleStep:M(o)}})).forEach((function(e){var t=e.link,n=e.angleStep;t.rotation=x(t.rotation,n),t.constraint}))}}(t,e,n,{acceptedError:30,learningRate:L}))})),h.createElement("mesh",{ref:r},h.createElement("boxBufferGeometry",{args:[50,50]}),h.createElement("meshNormalMaterial",null),o&&h.createElement(N,i({},o)))};function L(e){const t=p(e/1e3,0,1);if(t>.05)return 1e-4;return 1e-5+1e-4*(t/.02)}const V=({links:e,basePosition:t})=>{const n=a.exports.useRef();return l((()=>{var r;if(void 0===n.current)return;const{transforms:o}=D(e,{position:t,rotation:[1,0,0,0]});for(let e=0;e<n.current.children.length;e++){const t=n.current.children[e],i=null==(r=o[e])?void 0:r.position;if(void 0===i)throw new Error(`No corresponding child position for index ${e}`);t.position.set(...i)}})),h.createElement("group",{ref:n},Array.from({length:e.length+1}).map(((e,t)=>h.createElement("mesh",{key:t},h.createElement("boxBufferGeometry",{args:[12.5,12.5,12.5]}),h.createElement("meshBasicMaterial",{color:"red"})))))},J=(e,t)=>{const n=a.exports.useRef(),r=a.exports.useRef(),o=a.exports.useCallback((async i=>{void 0===r.current&&(r.current=i);const a=i-r.current;a>1e3/e&&(await t(a),r.current=i),n.current=requestAnimationFrame(o)}),[t,e]);a.exports.useEffect((()=>(n.current=requestAnimationFrame(o),()=>{n.current&&cancelAnimationFrame(n.current)})),[o])},T=({target:e,links:t,basePosition:n})=>{const r=a.exports.useRef(null);return J(1,(()=>{r.current&&(r.current.innerText=O(t,{position:n,rotation:[1,0,0,0]},e).toFixed(3))})),h.createElement("div",{style:{position:"absolute",top:0,left:0,userSelect:"none"}},h.createElement("table",null,h.createElement("tbody",null,h.createElement("tr",null,h.createElement("td",null,"Distance"),h.createElement("td",{ref:r})))))},W=({position:e})=>h.createElement("mesh",{scale:[50,50,1],position:[...e]},h.createElement("boxBufferGeometry",null),h.createElement("meshBasicMaterial",{color:"hotpink"})),X=[{rotation:[1,0,0,0],length:50},{rotation:M([0,0,Math.PI/2]),constraint:Math.PI,length:200},{rotation:[1,0,0,0],constraint:Math.PI,length:200},{rotation:[1,0,0,0],constraint:Math.PI,length:200},{rotation:[1,0,0,0],constraint:Math.PI,length:200},{rotation:[1,0,0,0],constraint:Math.PI,length:200}],Y=[0,0,0];function $(){const[e,t]=a.exports.useState([500,50,0]);return h.createElement("div",{onClick:e=>{const n=[e.clientX-window.innerWidth/2,-e.clientY+window.innerHeight/2,500*Math.random()];t(n)}},h.createElement(g,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},linear:!0},h.createElement(E,null),h.createElement("group",{scale:[.005,.005,.005]},h.createElement(H,{position:Y,sequence:X,target:e}),h.createElement(V,{links:X,basePosition:Y}),h.createElement(W,{position:e}))),h.createElement(T,{target:e,links:X,basePosition:Y}))}const z=({link:e,child:t})=>{const n=a.exports.useRef(),r=a.exports.useRef();l((()=>{n.current&&r.current&&(n.current.rotation.set(0,0,e.rotation),r.current.position.set(e.length,0,0))}));const o=a.exports.useMemo((()=>{const t=[new s,new s(e.length,0,0)],n=(new c).setFromPoints(t),r=new u({color:new m("#8B008B")});return new f(n,r)}),[e.length]);return h.createElement("group",{ref:n},h.createElement("mesh",{ref:r},h.createElement("sphereBufferGeometry",{args:[20,100,100]}),h.createElement("meshNormalMaterial",null),t&&h.createElement(z,i({},t))),h.createElement("primitive",{object:o}))},K=({position:e,sequence:t,target:n})=>{const r=a.exports.useRef(),o=a.exports.useMemo((()=>function(e){let t;for(let n=e.length-1;n>=0;n--){const r={link:e[n]};void 0!==t?t={link:r.link,child:t}:t=r}return t}(t)),[t]);return l((()=>{r.current&&(r.current.position.set(...e,0),C(t,e,n))})),h.createElement("mesh",{ref:r},h.createElement("boxBufferGeometry",{args:[50,50]}),h.createElement("meshNormalMaterial",null),o&&h.createElement(z,i({},o)))};const Q=({links:e,basePosition:t})=>{const n=a.exports.useRef();return l((()=>{var r;if(void 0===n.current)return;const{transforms:o}=F(e,{position:t,rotation:0});for(let e=0;e<n.current.children.length;e++){const t=n.current.children[e],i=null==(r=o[e])?void 0:r.position;if(void 0===i)throw new Error(`No corresponding child position for index ${e}`);t.position.set(...i,100)}})),h.createElement("group",{ref:n},Array.from({length:e.length+1}).map(((e,t)=>h.createElement("mesh",{key:t},h.createElement("boxBufferGeometry",{args:[12.5,12.5]}),h.createElement("meshBasicMaterial",{color:"red"})))))},U=({target:e,links:t,basePosition:n})=>{const r=a.exports.useRef(null);return J(1,(()=>{r.current&&(r.current.innerText=j(t,{position:n,rotation:0},e).toFixed(3))})),h.createElement("div",{style:{position:"absolute",top:0,left:0,userSelect:"none"}},h.createElement("table",null,h.createElement("tbody",null,h.createElement("tr",null,h.createElement("td",null,"Distance"),h.createElement("td",{ref:r})))))},Z=({position:e})=>h.createElement("mesh",{scale:[50,50,1],position:[...e,-1]},h.createElement("boxBufferGeometry",null),h.createElement("meshBasicMaterial",{color:"hotpink"})),_=[{rotation:0,length:50},{rotation:0,constraint:Math.PI,length:200},{rotation:0,constraint:Math.PI,length:200},{rotation:0,constraint:Math.PI,length:200}],ee=[0,0];function te(){const[e,t]=a.exports.useState([500,50]);return h.createElement("div",{onClick:e=>{const n=[e.clientX-window.innerWidth/2,-e.clientY+window.innerHeight/2];t(n)}},h.createElement(g,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},orthographic:!0,linear:!0,camera:{near:-1e3}},h.createElement(K,{position:ee,sequence:_,target:e}),h.createElement(Q,{links:_,basePosition:ee}),h.createElement(Z,{position:e})),h.createElement(U,{target:e,links:_,basePosition:ee}))}function ne(){return h.createElement(d,{basename:"/"},h.createElement(re,null),h.createElement(v,{path:"/2d"},h.createElement(te,null)),h.createElement(v,{path:"/3d"},h.createElement($,null)))}function re(){return h.createElement("div",{style:{position:"absolute",zIndex:10}},h.createElement("ul",null,h.createElement("li",null,h.createElement(b,{to:"/2d"},"2D Demo")),h.createElement("li",null,h.createElement(b,{to:"/3d"},"3D Demo"))))}w.render(h.createElement(h.StrictMode,null,h.createElement(ne,null)),document.getElementById("root"));

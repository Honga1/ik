var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,i=(e,i)=>{for(var a in i||(i={}))n.call(i,a)&&o(e,a,i[a]);if(t)for(var a of t(i))r.call(i,a)&&o(e,a,i[a]);return e};import{r as a,u as l,V as s,B as c,L as u,C as m,a as f,R as h,c as p,b as g,O as d,H as E,d as v,e as w,f as b}from"./vendor.bb499e6b.js";var y=function(e,t,n){return Math.min(Math.max(t,e),n)},x=function(e){return e[0]+e[1]+e[2]},M=function(e){return Math.pow(function(e){return x((n=e,[(t=e)[0]*n[0],t[1]*n[1],t[2]*n[2]]));var t,n}(e),.5)},k=function(e,t){var n,r,o=(r=t,[(n=e)[0]-r[0],n[1]-r[1],n[2]-r[2]]);return M(o)},P=function(e){if(3!==e.length)throw new Error("Cannot create V3 from "+e+", length is "+e.length+". Length should be 3");return e},B=function(e,t){return n=[e,0,0],o=S(r=t),i=R(r,function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([0],n)),R(i,o).slice(1);var n,r,o,i},R=function(e,t){var n=e[1],r=e[2],o=e[3],i=e[0],a=t[1],l=t[2],s=t[3],c=t[0];return[i*c-n*a-r*l-o*s,n*c+i*a+r*s-o*l,r*c+i*l+o*a-n*s,o*c+i*s+n*l-r*a]},I=function(e){var t=e[0],n=e[1],r=e[2],o=Math.cos,i=Math.sin,a=o(t/2),l=o(n/2),s=o(r/2),c=i(t/2),u=i(n/2),m=i(r/2);return[a*l*s-c*u*m,c*l*s+a*u*m,a*u*s-c*l*m,a*l*m+c*u*s]},S=function(e){return[e[0],-e[1],-e[2],-e[3]]},G=function(e,t){var n=e[0],r=e.slice(1),o=P(r.map((function(e,r){var o=2*Math.atan(e/n),i=y(o,-t[r],t[r]);return Math.tan(.5*i)})));return function(e){var t=Math.hypot.apply(Math,e);return 0===t?[1,0,0,0]:[e[0]/t,e[1]/t,e[2]/t,e[3]/t]}([1,o[0],o[1],o[2]])},q=function(e,t,n){for(var r=new Array(2),o=0;o<2;o++){var i=e[o],a=t[o];r[o]=n(i,a)}return j(r)},A=function(e){return Math.pow(function(e){return Math.pow(e[0],2)+Math.pow(e[1],2)}(e),.5)},C=function(e,t){var n=q(e,t,(function(e,t){return e-t}));return A(n)},j=function(e){if(2!==e.length)throw new Error("Cannot create V2 from "+e+", length is "+e.length+". Length should be 2");return e},F=function(e,t){return r=t,o=(n=[e,0])[0],i=n[1],a=Math.cos(r),l=Math.sin(r),[o*a-i*l,o*l+i*a];var n,r,o,i,a,l};function O(e,t,n){var r=function(e,t){return D(e,t).effectorPosition}(e,t);return C(n,r)}function D(e,t){for(var n,r,o=[t],i=0;i<e.length;i++){var a=e[i],l=o[i],s=a.rotation+l.rotation,c=F(a.length,s),u=(n=c,r=l.position,q(n,r,(function(e,t){return e+t})));o.push({position:u,rotation:s})}return{transforms:o,effectorPosition:o[o.length-1].position}}function N(e,t,n){var r=function(e,t){return H(e,t).effectorPosition}(e,t);return k(n,r)}function H(e,t){for(var n,r,o=[t],i=0;i<e.length;i++){var a=e[i],l=o[i],s=R(l.rotation,a.rotation),c=B(a.length,s),u=(n=c,r=l.position,[n[0]+r[0],n[1]+r[1],n[2]+r[2]]);o.push({position:u,rotation:s})}return{transforms:o,effectorPosition:o[o.length-1].position}}const L=({link:e,child:t})=>{const n=a.exports.useRef(),r=a.exports.useRef();l((()=>{n.current&&r.current&&(n.current.quaternion.set(e.rotation[1],e.rotation[2],e.rotation[3],e.rotation[0]),r.current.position.set(e.length,0,0))}));const o=a.exports.useMemo((()=>{const t=[new s,new s(e.length,0,0)],n=(new c).setFromPoints(t),r=new u({color:new m("#8B008B")});return new f(n,r)}),[e.length]);return h.createElement("group",{ref:n},h.createElement("mesh",{ref:r},h.createElement("sphereBufferGeometry",{args:[20,8,8]}),h.createElement("meshStandardMaterial",{transparent:!0,wireframe:!0}),t&&h.createElement(L,i({},t))),h.createElement("primitive",{object:o}))},V=({position:e,sequence:t,target:n})=>{const r=a.exports.useRef(),o=a.exports.useMemo((()=>function(e){let t;for(let n=e.length-1;n>=0;n--){const r={link:e[n]};void 0!==t?t={link:r.link,child:t}:t=r}return t}(t)),[t]);return l((()=>{r.current&&(r.current.position.set(...e),function(e,t,n,r){var o,i,a,l=null!==(o=null==r?void 0:r.deltaAngle)&&void 0!==o?o:1e-5,s=null!==(i=null==r?void 0:r.learningRate)&&void 0!==i?i:1e-4,c=null!==(a=null==r?void 0:r.acceptedError)&&void 0!==a?a:0,u=H(e,{position:t,rotation:[1,0,0,0]}),m=u.transforms,f=u.effectorPosition,h=k(n,f);if(!(h<c)){if(m.length!==e.length+1)throw new Error("Joint transforms should have the same length as links + 1. Got "+m.length+", expected "+e.length);e.map((function(t,r){var o=P([0,0,0].map((function(o,i){var a=[0,0,0];a[i]=l;var c=N(function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([{length:t.length,rotation:R(t.rotation,I(P(a)))}],e.slice(r+1)),m[r],n);return-(c-h)/l*("function"==typeof s?s(c):s)})));return{link:t,angleStep:I(o)}})).forEach((function(e){var t,n,r,o=e.link,i=e.angleStep;if(o.rotation=R(o.rotation,i),void 0!==o.constraints){var a,l,s=(l=.5,[(a=[null!==(t=o.constraints.pitch)&&void 0!==t?t:1/0,null!==(n=o.constraints.yaw)&&void 0!==n?n:1/0,null!==(r=o.constraints.roll)&&void 0!==r?r:1/0])[0]*l,a[1]*l,a[2]*l]);o.rotation=G(o.rotation,s)}}))}}(t,e,n,{acceptedError:30,learningRate:J}))})),h.createElement("mesh",{ref:r},h.createElement("boxBufferGeometry",{args:[50,50]}),h.createElement("meshNormalMaterial",null),o&&h.createElement(L,i({},o)))};function J(e){const t=p(e/1e3,0,1);if(t>.1)return 1e-4;return 1e-5+1e-5*(t/.02)}const T=({links:e,basePosition:t})=>{const n=a.exports.useRef();return l((()=>{var r;if(void 0===n.current)return;const{transforms:o}=H(e,{position:t,rotation:[1,0,0,0]});for(let e=0;e<n.current.children.length;e++){const t=n.current.children[e],i=null==(r=o[e])?void 0:r.position;if(void 0===i)throw new Error(`No corresponding child position for index ${e}`);t.position.set(...i)}})),h.createElement("group",{ref:n},Array.from({length:e.length+1}).map(((e,t)=>h.createElement("mesh",{key:t},h.createElement("boxBufferGeometry",{args:[12.5,12.5,12.5]}),h.createElement("meshBasicMaterial",{color:"red"})))))},W=(e,t)=>{const n=a.exports.useRef(),r=a.exports.useRef(),o=a.exports.useCallback((async i=>{void 0===r.current&&(r.current=i);const a=i-r.current;a>1e3/e&&(await t(a),r.current=i),n.current=requestAnimationFrame(o)}),[t,e]);a.exports.useEffect((()=>(n.current=requestAnimationFrame(o),()=>{n.current&&cancelAnimationFrame(n.current)})),[o])},X=({target:e,links:t,basePosition:n})=>{const r=a.exports.useRef(null);return W(1,(()=>{r.current&&(r.current.innerText=N(t,{position:n,rotation:[1,0,0,0]},e).toFixed(3))})),h.createElement("div",{style:{position:"absolute",top:0,left:0,userSelect:"none"}},h.createElement("table",null,h.createElement("tbody",null,h.createElement("tr",null,h.createElement("td",null,"Distance"),h.createElement("td",{ref:r})))))},Y=({position:e})=>h.createElement("mesh",{scale:[50,50,1],position:[...e]},h.createElement("boxBufferGeometry",null),h.createElement("meshBasicMaterial",{color:"hotpink"})),$=[{length:100,rotation:[1,0,0,0],constraints:{roll:0,yaw:Math.PI,pitch:1.1*Math.PI}},{length:100,rotation:[1,0,0,0],constraints:{roll:Math.PI/2,yaw:5*Math.PI/6,pitch:0}},{length:30,rotation:[1,0,0,0],constraints:{roll:0,yaw:0,pitch:3*Math.PI/2}}],z=[0,0,0];function K(){const[e,t]=a.exports.useState([500,50,0]);return h.createElement("div",{onClick:e=>{const n=[e.clientX-window.innerWidth/2,-e.clientY+window.innerHeight/2,500*Math.random()];t(n)}},h.createElement(g,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},linear:!0},h.createElement(d,null),h.createElement("group",{scale:[.005,.005,.005]},h.createElement(V,{position:z,sequence:$,target:e}),h.createElement(T,{links:$,basePosition:z}),h.createElement(Y,{position:e}))),h.createElement(X,{target:e,links:$,basePosition:z}))}const Q=({link:e,child:t})=>{const n=a.exports.useRef(),r=a.exports.useRef();l((()=>{n.current&&r.current&&(n.current.rotation.set(0,0,e.rotation),r.current.position.set(e.length,0,0))}));const o=a.exports.useMemo((()=>{const t=[new s,new s(e.length,0,0)],n=(new c).setFromPoints(t),r=new u({color:new m("#8B008B")});return new f(n,r)}),[e.length]);return h.createElement("group",{ref:n},h.createElement("mesh",{ref:r},h.createElement("sphereBufferGeometry",{args:[20,100,100]}),h.createElement("meshNormalMaterial",null),t&&h.createElement(Q,i({},t))),h.createElement("primitive",{object:o}))},U=({position:e,sequence:t,target:n})=>{const r=a.exports.useRef(),o=a.exports.useMemo((()=>function(e){let t;for(let n=e.length-1;n>=0;n--){const r={link:e[n]};void 0!==t?t={link:r.link,child:t}:t=r}return t}(t)),[t]);return l((()=>{r.current&&(r.current.position.set(...e,0),function(e,t,n,r){var o,i,a,l=null!==(o=null==r?void 0:r.deltaAngle)&&void 0!==o?o:1e-5,s=null!==(i=null==r?void 0:r.learningRate)&&void 0!==i?i:1e-4,c=null!==(a=null==r?void 0:r.acceptedError)&&void 0!==a?a:0,u=D(e,{position:t,rotation:0}),m=u.transforms,f=u.effectorPosition,h=C(n,f);if(!(h<c)){if(m.length!==e.length+1)throw new Error("Joint transforms should have the same length as links + 1. Got "+m.length+", expected "+e.length);e.map((function(t,r){var o=O(function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([{length:t.length,rotation:t.rotation+l}],e.slice(r+1)),m[r],n);return{link:t,angleStep:-(o-h)/l*("function"==typeof s?s(o):s)}})).forEach((function(e){var t=e.link,n=e.angleStep;if(t.rotation+=n,void 0!==t.constraint){var r=t.constraint/2;t.rotation=y(t.rotation,-r,r)}}))}}(t,e,n))})),h.createElement("mesh",{ref:r},h.createElement("boxBufferGeometry",{args:[50,50]}),h.createElement("meshNormalMaterial",null),o&&h.createElement(Q,i({},o)))};const Z=({links:e,basePosition:t})=>{const n=a.exports.useRef();return l((()=>{var r;if(void 0===n.current)return;const{transforms:o}=D(e,{position:t,rotation:0});for(let e=0;e<n.current.children.length;e++){const t=n.current.children[e],i=null==(r=o[e])?void 0:r.position;if(void 0===i)throw new Error(`No corresponding child position for index ${e}`);t.position.set(...i,100)}})),h.createElement("group",{ref:n},Array.from({length:e.length+1}).map(((e,t)=>h.createElement("mesh",{key:t},h.createElement("boxBufferGeometry",{args:[12.5,12.5]}),h.createElement("meshBasicMaterial",{color:"red"})))))},_=({target:e,links:t,basePosition:n})=>{const r=a.exports.useRef(null);return W(1,(()=>{r.current&&(r.current.innerText=O(t,{position:n,rotation:0},e).toFixed(3))})),h.createElement("div",{style:{position:"absolute",top:0,left:0,userSelect:"none"}},h.createElement("table",null,h.createElement("tbody",null,h.createElement("tr",null,h.createElement("td",null,"Distance"),h.createElement("td",{ref:r})))))},ee=({position:e})=>h.createElement("mesh",{scale:[50,50,1],position:[...e,-1]},h.createElement("boxBufferGeometry",null),h.createElement("meshBasicMaterial",{color:"hotpink"})),te=[{rotation:0,length:50},{rotation:0,constraint:Math.PI,length:200},{rotation:0,constraint:Math.PI,length:200},{rotation:0,constraint:Math.PI,length:200}],ne=[0,0];function re(){const[e,t]=a.exports.useState([500,50]);return h.createElement("div",{onClick:e=>{const n=[e.clientX-window.innerWidth/2,-e.clientY+window.innerHeight/2];t(n)}},h.createElement(g,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},orthographic:!0,linear:!0,camera:{near:-1e3}},h.createElement(U,{position:ne,sequence:te,target:e}),h.createElement(Z,{links:te,basePosition:ne}),h.createElement(ee,{position:e})),h.createElement(_,{target:e,links:te,basePosition:ne}))}function oe(){return h.createElement(E,{basename:"/"},h.createElement(ie,null),h.createElement(v,{path:"/2d"},h.createElement(re,null)),h.createElement(v,{path:"/3d"},h.createElement(K,null)))}function ie(){return h.createElement("div",{style:{position:"absolute",zIndex:10}},h.createElement("ul",null,h.createElement("li",null,h.createElement(w,{to:"/2d"},"2D Demo")),h.createElement("li",null,h.createElement(w,{to:"/3d"},"3D Demo"))))}b.render(h.createElement(h.StrictMode,null,h.createElement(oe,null)),document.getElementById("root"));

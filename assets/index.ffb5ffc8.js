var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,l=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&a(e,n,t[n]);if(r)for(var n of r(t))i.call(t,n)&&a(e,n,t[n]);return e},s=(e,r)=>t(e,n(r));import{C as c,u,V as m,B as p,L as f,a as h,b as d,R as E,c as g,d as v,e as b,O as k,M as x,G as w,f as y,g as M,Q as R,h as C,i as P,D as S,H as A,j as B,k as j,l as L,m as q}from"./vendor.ae5100d7.js";var I=function(e,t,n){return Math.min(Math.max(t,e),n)},N=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},G=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},W=function(e){return e[0]+e[1]+e[2]},O=function(e){return Math.pow(function(e){return W(G(e,e))}(e),.5)},D=function(e,t){var n,r,o=(r=t,[(n=e)[0]-r[0],n[1]-r[1],n[2]-r[2]]);return O(o)},F=function(e){if(3!==e.length)throw new Error("Cannot create V3 from "+e+", length is "+e.length+". Length should be 3");return e},H=function(e){return[e.x,e.y,e.z]},z=function(e,t){var n=Y(t),r=T(t,N(N([],e),[0])),o=T(r,n);return[o[0],o[1],o[2]]},T=function(e,t){var n=e[0],r=e[1],o=e[2],i=e[3],a=t[0],l=t[1],s=t[2],c=t[3];return[n*c+i*a+r*s-o*l,r*c+i*l+o*a-n*s,o*c+i*s+n*l-r*a,i*c-n*a-r*l-o*s]},X=function(e){var t=e[0],n=e[1],r=e[2],o=Math.cos,i=Math.sin,a=o(t/2),l=o(n/2),s=o(r/2),c=i(t/2),u=i(n/2),m=i(r/2);return[c*l*s+a*u*m,a*u*s-c*l*m,a*l*m+c*u*s,a*l*s-c*u*m]},Y=function(e){return[-e[0],-e[1],-e[2],e[3]]},V=function(e){return Math.hypot.apply(Math,e)},J=function(e,t,n){var r=[e[0],e[1],e[2]],o=e[3],i=F(r.map((function(e,r){var i=2*Math.atan(e/o),a=t[r],l=n[r];if(a>l)throw new Error("Lower bound should be less than upper bound for component "+r+". Lower: "+a+", upper: "+l);var s=I(i,a,l);return Math.tan(.5*s)})));return function(e){var t=Math.hypot.apply(Math,e);return 0===t?[0,0,0,1]:[e[0]/t,e[1]/t,e[2]/t,e[3]/t]}([i[0],i[1],i[2],1])},Q=function(e){return[e.x,e.y,e.z,e.w]},$=function(e,t,n){for(var r=new Array(2),o=0;o<2;o++){var i=e[o],a=t[o];r[o]=n(i,a)}return _(r)},U=function(e){return Math.pow(function(e){return Math.pow(e[0],2)+Math.pow(e[1],2)}(e),.5)},K=function(e,t){var n=$(e,t,(function(e,t){return e-t}));return U(n)},Z=function(e,t){var n=e[0],r=e[1],o=Math.cos(t),i=Math.sin(t);return[n*o-r*i,n*i+r*o]},_=function(e){if(2!==e.length)throw new Error("Cannot create V2 from "+e+", length is "+e.length+". Length should be 2");return e},ee=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e};function te(e,t,n,r){var o,i,a,l=null!==(o=null==r?void 0:r.deltaAngle)&&void 0!==o?o:1e-5,s=null!==(i=null==r?void 0:r.learningRate)&&void 0!==i?i:1e-4,c=null!==(a=null==r?void 0:r.acceptedError)&&void 0!==a?a:0,u=re(e,t),m=u.transforms,p=u.effectorPosition,f=K(n,p);if(f<c)return{links:e.map(oe),isWithinAcceptedError:!0,getErrorDistance:function(){return f}};if(m.length!==e.length+1)throw new Error("Joint transforms should have the same length as links + 1. Got "+m.length+", expected "+e.length);var h=e.map((function(t,r){var o=t.rotation,i=void 0===o?0:o,a=t.position,c=t.constraints,u=ne(ee([{position:a,rotation:i+l}],e.slice(r+1)),m[r],n);return{rotation:i+-((u-f)/l)*("function"==typeof s?s(u):s),position:a,constraints:c}})),d=re(h,t).transforms,E=h.map((function(e,t){var n=e.position,r=e.rotation,o=e.constraints;if(void 0===o)return{position:n,rotation:r};if("number"==typeof o){var i=o/2;return{position:n,rotation:I(r,-i,i),constraints:o}}return function(e){return void 0!==e.value}(o)?"global"===o.type?{position:n,rotation:r+(o.value-d[t+1].rotation),constraints:o}:{position:n,rotation:o.value,constraints:o}:{position:n,rotation:I(r,o.min,o.max),constraints:o}}));return{links:E,getErrorDistance:function(){return ne(E,t,n)},isWithinAcceptedError:void 0}}function ne(e,t,n){var r=function(e,t){return re(e,t).effectorPosition}(e,t);return K(n,r)}function re(e,t){for(var n,r,o,i=[t],a=0;a<e.length;a++){var l=e[a],s=i[a],c=(null!==(n=l.rotation)&&void 0!==n?n:0)+s.rotation,u=Z(l.position,c),m=(r=u,o=s.position,$(r,o,(function(e,t){return e+t})));i.push({position:m,rotation:c})}return{transforms:i,effectorPosition:i[i.length-1].position,effectorRotation:i[i.length-1].rotation}}function oe(e){var t=e.rotation,n=e.position,r=e.constraints;return{rotation:t,position:ee([],n),constraints:void 0===r?void 0:r}}var ie=function(){return(ie=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},ae=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e};function le(e,t,n,r){var o,i,a,l=null!==(o=null==r?void 0:r.deltaAngle)&&void 0!==o?o:1e-5,s=null!==(i=null==r?void 0:r.learningRate)&&void 0!==i?i:1e-4,c=null!==(a=null==r?void 0:r.acceptedError)&&void 0!==a?a:0,u=ce(e,t),m=u.transforms,p=u.effectorPosition,f=D(n,p);if(f<c)return{links:e.map(ue),isWithinAcceptedError:!0,getErrorDistance:function(){return f}};if(m.length!==e.length+1)throw new Error("Joint transforms should have the same length as links + 1. Got "+m.length+", expected "+e.length);var h=e.map((function(t,r){var o=t.position,i=t.rotation,a=void 0===i?[0,0,0,1]:i,c=t.constraints,u=F([0,0,0].map((function(t,i){var c=[0,0,0];c[i]=l;var u={position:o,rotation:T(a,X(F(c)))},p=se(ae([u],e.slice(r+1)),m[r],n);return-((p-f)/l)*("function"==typeof s?s(p):s)}))),p=T(a,X(u));return{position:o,rotation:p,constraints:c}})),d=ce(h,t).transforms,E=h.map((function(e,t){var n,r,o,i=e.position,a=e.rotation,l=e.constraints;if(void 0===l)return{position:i,rotation:a};if(pe(l)){if("global"===l.type){var s=l.value,c=d[t+1].rotation;return{position:i,rotation:T(T(a,(r=Y(n=c),o=V(n),[r[0]/o,r[1]/o,r[2]/o,r[3]/o])),s),constraints:l}}return{position:i,rotation:l.value,constraints:l}}var u,m,p,f,h,E,g=l.pitch,v=l.yaw,b=l.roll;return"number"==typeof g?(u=-g/2,m=g/2):void 0===g?(u=-1/0,m=1/0):(u=g.min,m=g.max),"number"==typeof v?(p=-v/2,f=v/2):void 0===v?(p=-1/0,f=1/0):(p=v.min,f=v.max),"number"==typeof b?(h=-b/2,E=b/2):void 0===b?(h=-1/0,E=1/0):(h=b.min,E=b.max),{position:i,rotation:J(a,[u,p,h],[m,f,E]),constraints:me(l)}}));return{links:E,getErrorDistance:function(){return se(E,t,n)},isWithinAcceptedError:void 0}}function se(e,t,n){var r=function(e,t){return ce(e,t).effectorPosition}(e,t);return D(n,r)}function ce(e,t){for(var n,r,o,i=[ie({},t)],a=0;a<e.length;a++){var l=e[a],s=i[a],c=T(s.rotation,null!==(n=l.rotation)&&void 0!==n?n:[0,0,0,1]),u=z(l.position,c),m=(r=u,o=s.position,[r[0]+o[0],r[1]+o[1],r[2]+o[2]]);i.push({position:m,rotation:c})}return{transforms:i,effectorPosition:i[i.length-1].position}}function ue(e){var t=e.rotation,n=e.position,r=e.constraints;return{rotation:t,position:ae([],n),constraints:void 0===r?void 0:me(r)}}function me(e){var t={};if(pe(e))return{type:e.type,value:ae([],e.value)};var n=e.pitch,r=e.yaw,o=e.roll;return"number"==typeof n?t.pitch=n:void 0!==typeof n&&(t.pitch=ie({},n)),"number"==typeof r?t.yaw=r:void 0!==typeof r&&(t.yaw=ie({},r)),"number"==typeof o?t.roll=o:void 0!==typeof o&&(t.roll=ie({},o)),t}function pe(e){return void 0!==e.value}const fe=({link:e,child:t})=>{const n=c.exports.useRef(),r=c.exports.useRef();u((()=>{n.current&&r.current&&(n.current.quaternion.set(...e.rotation),r.current.position.set(...e.position))}));const o=c.exports.useMemo((()=>{const t=[new m,new m(...e.position)],n=(new p).setFromPoints(t),r=new f({color:new h("#8B008B")});return new d(n,r)}),[e]);return E.createElement("group",{ref:n},E.createElement("mesh",{ref:r},E.createElement("sphereBufferGeometry",{args:[.2,8,8]}),E.createElement("meshStandardMaterial",{transparent:!0,wireframe:!0}),t&&E.createElement(fe,l({},t))),E.createElement("primitive",{object:o}))},he=({base:e,links:t})=>{const n=c.exports.useRef(),r=c.exports.useMemo((()=>function(e){var t;let n;for(let r=e.length-1;r>=0;r--){const o={link:s(l({},e[r]),{rotation:null!=(t=e[r].rotation)?t:[0,0,0,1]})};void 0!==n?n={link:o.link,child:n}:n=o}return n}(t)),[t]);return u((()=>{var o;if(!n.current)return;n.current.position.set(...e.position),n.current.quaternion.set(...e.rotation);let i=0,a=r;for(;void 0!==a&&void 0!==t[i];)a.link.rotation=null!=(o=t[i].rotation)?o:[0,0,0,1],i++,a=a.child})),E.createElement("mesh",{ref:n},E.createElement("boxBufferGeometry",{args:[.3,.3,.01]}),E.createElement("meshNormalMaterial",null),r&&E.createElement(fe,l({},r)))};const de=({links:e,base:t})=>{const n=c.exports.useRef();u((()=>{var r;if(void 0===n.current)return;const{transforms:o}=ce(e,t);for(let e=0;e<n.current.children.length;e++){const t=n.current.children[e],i=null==(r=o[e])?void 0:r.position;if(void 0===i)throw new Error(`No corresponding child position for index ${e}`);t.position.set(...i)}}));const r=c.exports.useMemo((()=>Array.from({length:e.length+1}).map(((e,t)=>E.createElement("mesh",{key:t},E.createElement("boxBufferGeometry",{args:[.1,.1,.5]}),E.createElement("meshBasicMaterial",{color:"red"}))))),[e]);return E.createElement("group",{ref:n},r)},Ee=({position:e,setPosition:t})=>{const{camera:n}=g();return c.exports.useEffect((()=>{const e=e=>{const r=new m,o=new m;r.set(e.clientX/window.innerWidth*2-1,-e.clientY/window.innerHeight*2+1,.5),r.unproject(n),r.sub(n.position).normalize();const i=-n.position.z/r.z;o.copy(n.position).add(r.multiplyScalar(i)),t(H(o))};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}}),[]),E.createElement("mesh",{position:[...e]},E.createElement("boxBufferGeometry",{args:[.3,.3,.3]}),E.createElement("meshBasicMaterial",{color:"hotpink"}))};var ge="https://tmf-code.github.io/inverse-kinematics/assets/arm2.2c2f3b19.gltf";function ve(){return E.createElement(b,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"purple"},linear:!0},E.createElement(c.exports.Suspense,{fallback:null},E.createElement(be,null)))}function be(){const{nodes:e}=v(ge),t=c.exports.useRef(),[n,r]=c.exports.useState([0,0,0]),[o]=c.exports.useState({position:[0,0,0],rotation:[0,0,0,1]}),[i,a]=c.exports.useState([]),l=c.exports.useRef(null);return u((()=>{var e;const r=null==(e=t.current)?void 0:e.children.find((e=>e.isBone));if(!r)return;const i={position:H(r.position),rotation:[0,0,0,1]};o.position=i.position,o.rotation=i.rotation;const l=function(e){let t=e;const n=[e];for(;void 0!==t.children[0];)n.push(t.children[0]),t=t.children[0];return n}(r),s=l.map(((e,t,n)=>{var r;const o=n[t+1],i=Q(e.quaternion);return{position:H(null!=(r=null==o?void 0:o.position)?r:e.position),rotation:i}})),c=s.reduce(((e,t)=>e+O(t.position)),0);const u=le(s,i,n,{learningRate:function(e){const t=I(e/c,0,1);return t>.1?.001:1e-4+1e-4*(t/.02)},acceptedError:c/1e3}).links;u.forEach(((e,t,n)=>{l[t].quaternion.set(...e.rotation)})),a(u)})),E.createElement(E.Fragment,null,E.createElement(k,{ref:l}),E.createElement(Ee,{position:n,setPosition:r}),E.createElement(he,{base:o,links:i}),E.createElement(de,{base:o,links:i}),E.createElement("group",{ref:t,dispose:null},E.createElement("primitive",{object:e.shoulder}),E.createElement("skinnedMesh",{geometry:e.Cylinder.geometry,material:new x,skeleton:e.Cylinder.skeleton})),E.createElement("skeletonHelper",{args:[e.shoulder]}),E.createElement(w,{alignment:"bottom-right",margin:[80,80],onTarget:()=>{var e;return null==(e=null==l?void 0:l.current)?void 0:e.target},onUpdate:()=>{var e;return null==(e=l.current)?void 0:e.update()}},E.createElement(y,{axisColors:["red","green","blue"],labelColor:"black"})))}v.preload(ge);const ke=(e,t)=>{const n=c.exports.useRef(),r=c.exports.useRef(),o=c.exports.useCallback((async i=>{void 0===r.current&&(r.current=i);const a=i-r.current;a>1e3/e&&(await t(a),r.current=i),n.current=requestAnimationFrame(o)}),[t,e]);c.exports.useEffect((()=>(n.current=requestAnimationFrame(o),()=>{n.current&&cancelAnimationFrame(n.current)})),[o])},xe=({target:e,links:t,base:n})=>{const r=c.exports.useRef(null);return ke(1,(()=>{r.current&&(r.current.innerText=se(t,n,e).toFixed(3))})),E.createElement("div",{style:{position:"absolute",top:0,left:0,userSelect:"none"}},E.createElement("table",null,E.createElement("tbody",null,E.createElement("tr",null,E.createElement("td",null,"Distance"),E.createElement("td",{ref:r})))))},we={position:[0,0,0],rotation:[0,0,0,1]};function ye(){const[e,t]=c.exports.useState([500,50,0]),[n,r]=c.exports.useState([]),{linkCount:o,linkLength:i,linkMinAngle:a,linkMaxAngle:l}=M({linkCount:{value:4,min:0,max:50,step:1},linkLength:{value:1,min:.1,max:2,step:.1},linkMinAngle:{value:-90,min:-360,max:0,step:10},linkMaxAngle:{value:90,min:0,max:360,step:10}});return c.exports.useEffect((()=>{r(Me(o,i,a,l))}),[o,i,a,l]),ke(60,(()=>{const t=o*i;const r=le(n,we,e,{learningRate:function(e){const n=I(e/t,0,1);return n>.5?.01:(.001+.001*(n/.02))/t},acceptedError:.1}).links;n.forEach(((e,t)=>{n[t]=r[t]}))})),E.createElement("div",null,E.createElement(b,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},linear:!0},E.createElement(k,null),E.createElement("group",null,E.createElement(he,{base:we,links:n}),E.createElement(de,{links:n,base:we}),E.createElement(Ee,{position:e,setPosition:t}))),E.createElement(xe,{target:e,links:n,base:we}))}const Me=(e,t,n,r)=>Array.from({length:e}).map((()=>({position:[t,0,0],rotation:[0,0,0,1],constraints:{pitch:{min:n*Math.PI/180,max:r*Math.PI/180},yaw:{min:n*Math.PI/180,max:r*Math.PI/180},roll:{min:n*Math.PI/180,max:r*Math.PI/180}}})));function Re(){const[e,t]=c.exports.useState([500,50,0]),[n,r]=c.exports.useState([]),[o,i]=c.exports.useState({position:[0,0,0],rotation:[0,0,0,1]}),a=c.exports.useRef(void 0),l=c.exports.useRef();return c.exports.useEffect((()=>{if(void 0===l.current)return;if(void 0!==a.current)return;const e=[],t=n=>{e.push(n),n.children[0]&&t(n.children[0])};l.current.children[0]&&t(l.current.children[0]);const n=e.map((e=>({rotation:Q(e.quaternion),position:H(e.position)})));r(n),i({position:H(l.current.getWorldPosition(new m)),rotation:Q(l.current.getWorldQuaternion(new R))}),a.current=e})),ke(60,(()=>{if(!a.current)return;const t=n.reduce(((e,t)=>e+O(t.position)),0);const r=le(n,o,e,{learningRate:function(e){const n=I(e/t,0,1);return n>.1?.01:.001+.001*(n/.02)},acceptedError:t/1e3}).links;n.forEach(((e,t)=>{const o=r[t];n[t]=o;const i=o.rotation,l=a.current[t],s=null==l?void 0:l.position.length(),c=z([s,0,0],i);l.position.set(...c),l.quaternion.set(...i)}))})),E.createElement("div",null,E.createElement(b,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},linear:!0},E.createElement(k,null),E.createElement(he,{base:o,links:n}),E.createElement(de,{links:n,base:o}),E.createElement(Ee,{position:e,setPosition:t}),E.createElement("group",{position:[0,0,0],ref:l},E.createElement("mesh",{position:[2,0,0]},E.createElement("sphereBufferGeometry",{args:[.3]}),E.createElement("meshNormalMaterial",{wireframe:!0}),E.createElement("mesh",{position:[2,0,0]},E.createElement("sphereBufferGeometry",{args:[.3]}),E.createElement("meshNormalMaterial",{wireframe:!0}),E.createElement("mesh",{position:[2,0,0]},E.createElement("sphereBufferGeometry",{args:[.3]}),E.createElement("meshNormalMaterial",{wireframe:!0})))))),E.createElement(xe,{target:e,links:n,base:o}))}const Ce=({link:e,child:t})=>{const n=c.exports.useRef(),r=c.exports.useRef();u((()=>{n.current&&r.current&&(n.current.rotation.set(0,0,e.rotation),r.current.position.set(...e.position,0))}));const o=c.exports.useMemo((()=>{const t=[new m,new m(...e.position,0)],n=(new p).setFromPoints(t),r=new f({color:new h("#8B008B")});return new d(n,r)}),[e]);return E.createElement("group",{ref:n},E.createElement("mesh",{ref:r},E.createElement("sphereBufferGeometry",{args:[20,100,100]}),E.createElement("meshNormalMaterial",null),t&&E.createElement(Ce,l({},t))),E.createElement("primitive",{object:o}))},Pe=({base:e,links:t})=>{const n=c.exports.useRef(),r=c.exports.useMemo((()=>function(e){var t;let n;for(let r=e.length-1;r>=0;r--){const o={link:s(l({},e[r]),{rotation:null!=(t=e[r].rotation)?t:0})};void 0!==n?n={link:o.link,child:n}:n=o}return n}(t)),[t]);return u((()=>{var o;if(!n.current)return;n.current.position.set(...e.position,0),n.current.rotation.set(0,0,e.rotation);let i=0,a=r;for(;void 0!==a&&void 0!==t[i];)a.link.rotation=null!=(o=t[i].rotation)?o:0,i++,a=a.child})),E.createElement("mesh",{ref:n},E.createElement("boxBufferGeometry",{args:[50,50]}),E.createElement("meshNormalMaterial",null),r&&E.createElement(Ce,l({},r)))};const Se=({links:e,base:t})=>{const n=c.exports.useRef();u((()=>{var r;if(void 0===n.current)return;const{transforms:o}=re(e,t);for(let e=0;e<n.current.children.length;e++){const t=n.current.children[e],i=null==(r=o[e])?void 0:r.position;if(void 0===i)throw new Error(`No corresponding child position for index ${e}`);t.position.set(...i,100)}}));const r=c.exports.useMemo((()=>Array.from({length:e.length+1}).map(((e,t)=>E.createElement("mesh",{key:t},E.createElement("boxBufferGeometry",{args:[12.5,12.5]}),E.createElement("meshBasicMaterial",{color:"red"}))))),[e]);return E.createElement("group",{ref:n},r)},Ae=({target:e,links:t,base:n})=>{const r=c.exports.useRef(null);return ke(1,(()=>{r.current&&(r.current.innerText=ne(t,n,e).toFixed(3))})),E.createElement("div",{style:{position:"absolute",top:0,left:0,userSelect:"none"}},E.createElement("table",null,E.createElement("tbody",null,E.createElement("tr",null,E.createElement("td",null,"Distance"),E.createElement("td",{ref:r})))))},Be=({position:e})=>E.createElement("mesh",{scale:[50,50,1],position:[...e,-1]},E.createElement("boxBufferGeometry",null),E.createElement("meshBasicMaterial",{color:"hotpink"})),je={position:[0,0],rotation:0};function Le(){const[e,t]=c.exports.useState([500,50]),[n,r]=c.exports.useState([]),{linkCount:o,linkLength:i,linkMinAngle:a,linkMaxAngle:l}=M({linkCount:{value:4,min:0,max:50,step:1},linkLength:{value:200,min:1,max:200,step:10},linkMinAngle:{value:-90,min:-360,max:0,step:10},linkMaxAngle:{value:90,min:0,max:360,step:10}});return c.exports.useEffect((()=>{r(qe(o,i,a,l))}),[o,i,a,l]),ke(60,(()=>{const t=o*i;const r=te(n,je,e,{learningRate:function(e){const n=I(e/t,0,1);return n>.1?1e-5:1e-6+1e-6*(n/.02)},acceptedError:10}).links;n.forEach(((e,t)=>{n[t]=r[t]}))})),E.createElement("div",{onClick:({clientX:e,clientY:n})=>t([e-window.innerWidth/2,-n+window.innerHeight/2])},E.createElement(b,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},orthographic:!0,linear:!0,camera:{near:-1e3}},E.createElement(Se,{links:n,base:je}),E.createElement(Pe,{base:je,links:n}),E.createElement(Be,{position:e})),E.createElement(Ae,{target:e,links:n,base:je}))}const qe=(e,t,n,r)=>Array.from({length:e}).map((()=>({position:[t,0],constraint:{min:n*Math.PI/180,max:r*Math.PI/180},rotation:0}))),Ie={position:[0,0],rotation:0};function Ne(){const[e,t]=c.exports.useState([500,50]),[n,r]=c.exports.useState([]),{linkCount:o,linkLength:i,endEffectorRotation:a}=M({linkCount:{value:4,min:0,max:50,step:1},linkLength:{value:200,min:1,max:200,step:10},endEffectorRotation:{value:0,min:-180,max:180,step:5}});return c.exports.useEffect((()=>{r(Ge(o,i,a))}),[o,i,a]),ke(60,(()=>{const t=o*i;const r=te(n,Ie,e,{learningRate:function(e){const n=I(e/t,0,1);return n>.1?1e-5:1e-6+1e-6*(n/.02)},acceptedError:10}).links;n.forEach(((e,t)=>{n[t]=r[t]}))})),E.createElement("div",{onClick:({clientX:e,clientY:n})=>t([e-window.innerWidth/2,-n+window.innerHeight/2])},E.createElement(b,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},orthographic:!0,linear:!0,camera:{near:-1e3}},E.createElement(Se,{links:n,base:Ie}),E.createElement(Pe,{base:Ie,links:n}),E.createElement(Be,{position:e})),E.createElement(Ae,{target:e,links:n,base:Ie}))}const Ge=(e,t,n)=>Array.from({length:e}).map(((r,o)=>o===e-1?{position:[t,0],constraints:{value:n*Math.PI/180,type:"local"},rotation:0}:{position:[t,0],rotation:0})),We={position:[0,0,0],rotation:[0,0,0,1]};function Oe(){const[e,t]=c.exports.useState([500,50,0]),[n,r]=c.exports.useState([]),{linkCount:o,linkLength:i,endEffectorRotation:a}=M({linkCount:{value:4,min:0,max:50,step:1},linkLength:{value:1,min:.1,max:2,step:.1},endEffectorRotation:{value:0,min:-180,max:180,step:5}});return c.exports.useEffect((()=>{r(De(o,i,a))}),[o,i,a]),ke(60,(()=>{const t=o*i;const r=le(n,We,e,{learningRate:function(e){const n=I(e/t,0,1);return n>.5?.01:(.001+.001*(n/.02))/t},acceptedError:.1}).links;n.forEach(((e,t)=>{n[t]=r[t]}))})),E.createElement("div",null,E.createElement(b,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},linear:!0},E.createElement(k,null),E.createElement(de,{links:n,base:We}),E.createElement(he,{base:We,links:n}),E.createElement(Ee,{position:e,setPosition:t})),E.createElement(xe,{target:e,links:n,base:We}))}const De=(e,t,n)=>Array.from({length:e}).map(((r,o)=>o===e-1?{position:[t,0,0],constraints:{value:X([0,0,n*Math.PI/180]),type:"local"},rotation:[0,0,0,1]}:{position:[t,0,0],rotation:[0,0,0,1]})),Fe={position:[0,0],rotation:0};function He(){const[e,t]=c.exports.useState([500,50]),[n,r]=c.exports.useState([]),{linkCount:o,linkLength:i,endEffectorRotation:a}=M({linkCount:{value:4,min:0,max:50,step:1},linkLength:{value:200,min:1,max:200,step:10},endEffectorRotation:{value:0,min:-180,max:180,step:15}});return c.exports.useEffect((()=>{r(ze(o,i,a))}),[o,i,a]),ke(60,(()=>{const t=o*i;const r=te(n,Fe,e,{learningRate:function(e){const n=I(e/t,0,1);return n>.1?1e-5:1e-6+1e-6*(n/.02)},acceptedError:10}).links;n.forEach(((e,t)=>{n[t]=r[t]}))})),E.createElement("div",{onClick:({clientX:e,clientY:n})=>t([e-window.innerWidth/2,-n+window.innerHeight/2])},E.createElement(b,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},orthographic:!0,linear:!0,camera:{near:-1e3}},E.createElement(Se,{links:n,base:Fe}),E.createElement(Pe,{base:Fe,links:n}),E.createElement(Be,{position:e})),E.createElement(Ae,{target:e,links:n,base:Fe}))}const ze=(e,t,n)=>Array.from({length:e}).map(((r,o)=>{return o===e-1?{position:[t,0],constraints:{value:n*Math.PI/180,type:"global"},rotation:0}:(void 0===i&&(i=0),{position:[t,0],rotation:i,constraints:a});var i,a})),Te={position:[0,0,0],rotation:[0,0,0,1]};function Xe(){const[e,t]=c.exports.useState([500,50,0]),[n,r]=c.exports.useState([]),{linkCount:o,linkLength:i,endEffectorRotation:a}=M({linkCount:{value:4,min:0,max:50,step:1},linkLength:{value:1,min:.1,max:2,step:.1},endEffectorRotation:{value:0,min:-180,max:180,step:5}});return c.exports.useEffect((()=>{r(Ye(o,i,a))}),[o,i,a]),ke(60,(()=>{const t=o*i;const r=le(n,Te,e,{learningRate:function(e){const n=I(e/t,0,1);return n>.5?.01:(.001+.001*(n/.02))/t},acceptedError:.1}).links;n.forEach(((e,t)=>{n[t]=r[t]}))})),E.createElement("div",null,E.createElement(b,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},linear:!0},E.createElement(k,null),E.createElement(de,{links:n,base:Te}),E.createElement(he,{base:Te,links:n}),E.createElement(Ee,{position:e,setPosition:t})),E.createElement(xe,{target:e,links:n,base:Te}))}const Ye=(e,t,n)=>Array.from({length:e}).map(((r,o)=>o===e-1?{position:[t,0,0],constraints:{value:X([0,0,n*Math.PI/180]),type:"global"},rotation:[0,0,0,1]}:{position:[t,0,0],rotation:[0,0,0,1]}));var Ve="https://tmf-code.github.io/inverse-kinematics/assets/arm2.2c2f3b19.gltf";function Je(){return E.createElement(C,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},linear:!0},E.createElement(Qe,null))}function Qe(){const{nodes:e}=v(Ve),t=c.exports.useRef(),[n]=c.exports.useState({position:[0,0,0],rotation:[0,0,0,1]}),[r,o]=c.exports.useState([]),i=P("left");return u((()=>{var e;const r=null==(e=t.current)?void 0:e.children.find((e=>e.isBone));if(!r)return;const a={position:H(r.getWorldPosition(new m)),rotation:[0,0,0,1]};n.position=a.position,n.rotation=a.rotation;const l=H(t.current.getWorldScale(new m)),s=function(e){let t=e;const n=[e];for(;void 0!==t.children[0];)n.push(t.children[0]),t=t.children[0];return n}(r),c=s.map(((e,t,n)=>{var r;const o=n[t+1],i=Q(e.quaternion);return{position:G(H(null!=(r=null==o?void 0:o.position)?r:e.position),l),rotation:i}})),u=c.reduce(((e,t)=>e+O(t.position)),0);if(i){const e=le(c,a,H(null==i?void 0:i.controller.getWorldPosition(new m)),{learningRate:(p=u,e=>{const t=I(e/p,0,1);if(t>.1)return.001;const n=t/.02;return 1e-4+1e-4*n}),acceptedError:u/1e3}).links;e.forEach(((e,t,n)=>{s[t].quaternion.set(...e.rotation)})),o(e)}var p})),E.createElement(E.Fragment,null,E.createElement("ambientLight",null),E.createElement(S,null),E.createElement(he,{base:n,links:r}),E.createElement(de,{base:n,links:r}),E.createElement(c.exports.Suspense,{fallback:null},E.createElement("group",{dispose:null,scale:[.2,.2,.2],position:[-1,1.5,-2]},E.createElement("group",{ref:t,dispose:null},E.createElement("primitive",{object:e.shoulder}),E.createElement("skinnedMesh",{geometry:e.Cylinder.geometry,material:new x({wireframe:!0}),skeleton:e.Cylinder.skeleton}))),E.createElement("skeletonHelper",{args:[e.shoulder]})))}function $e(){return E.createElement(A,{basename:"/"},E.createElement(Ue,null),E.createElement(B,{path:"/2d"},E.createElement(Le,null)),E.createElement(B,{path:"/2d-local"},E.createElement(Ne,null)),E.createElement(B,{path:"/2d-global"},E.createElement(He,null)),E.createElement(B,{exact:!0,path:"/"},E.createElement(Le,null)),E.createElement(B,{path:"/3d"},E.createElement(ye,null)),E.createElement(B,{path:"/3d-local"},E.createElement(Oe,null)),E.createElement(B,{path:"/3d-global"},E.createElement(Xe,null)),E.createElement(B,{path:"/three-js"},E.createElement(Re,null)),E.createElement(B,{path:"/skinned-mesh"},E.createElement(c.exports.Suspense,{fallback:null},E.createElement(ve,null))),E.createElement(B,{path:"/web-xr"},E.createElement(c.exports.Suspense,{fallback:null},E.createElement(Je,null))))}function Ue(){const e=j().pathname;return E.createElement("div",{style:{position:"absolute",zIndex:10}},E.createElement("h2",null,"Inverse kinematics examples"),E.createElement("a",{href:"https://github.com/tmf-code/inverse-kinematics"},"Github page"),E.createElement("h3",null,"2d"),E.createElement("ul",null,E.createElement("li",{className:"/2d"===e?"highlighted":""},E.createElement(L,{to:"/2d"},"2D basic")),E.createElement("li",{className:"/2d-local"===e?"highlighted":""},E.createElement(L,{to:"/2d-local"},"Constrained local rotation")),E.createElement("li",{className:"/2d-global"===e?"highlighted":""},E.createElement(L,{to:"/2d-global"},"Constrained global rotation"))),E.createElement("h3",null,"3d"),E.createElement("ul",null,E.createElement("li",{className:"/3d"===e?"highlighted":""},E.createElement(L,{to:"/3d"},"3D basic")),E.createElement("li",{className:"/three-js"===e?"highlighted":""},E.createElement(L,{to:"/three-js"},"Three.js")),E.createElement("li",null,E.createElement(L,{to:"/skinned-mesh"},"Three js Skinned Mesh")),E.createElement("li",{className:"/web-xr"===e?"highlighted":""},E.createElement(L,{to:"/web-xr"},"Web XR")),E.createElement("li",{className:"/3d-local"===e?"highlighted":""},E.createElement(L,{to:"/3d-local"},"Constrained local rotation")),E.createElement("li",{className:"/3d-global"===e?"highlighted":""},E.createElement(L,{to:"/3d-global"},"Constrained global rotation"))))}v.preload(Ve),q.render(E.createElement(E.StrictMode,null,E.createElement($e,null)),document.getElementById("root"));

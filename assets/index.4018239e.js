var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,a=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&l(e,n,t[n]);if(r)for(var n of r(t))i.call(t,n)&&l(e,n,t[n]);return e},c=(e,r)=>t(e,n(r));import{r as s,u,V as m,B as f,L as h,C as p,a as d,R as g,b as v,c as E,O as x,H as k,d as b,e as y,f as w,g as M}from"./vendor.6aff221f.js";var A=function(e,t,n){return Math.min(Math.max(t,e),n)},B=function(e){return e[0]+e[1]+e[2]},P=function(e){return Math.pow(function(e){return B((n=e,[(t=e)[0]*n[0],t[1]*n[1],t[2]*n[2]]));var t,n}(e),.5)},R=function(e,t){var n,r,o=(r=t,[(n=e)[0]-r[0],n[1]-r[1],n[2]-r[2]]);return P(o)},O=function(e){if(3!==e.length)throw new Error("Cannot create V3 from "+e+", length is "+e.length+". Length should be 3");return e},S=function(e,t){return n=[e,0,0],o=G(r=t),i=C(r,function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([0],n)),C(i,o).slice(1);var n,r,o,i},C=function(e,t){var n=e[1],r=e[2],o=e[3],i=e[0],l=t[1],a=t[2],c=t[3],s=t[0];return[i*s-n*l-r*a-o*c,n*s+i*l+r*c-o*a,r*s+i*a+o*l-n*c,o*s+i*c+n*a-r*l]},j=function(e){var t=e[0],n=e[1],r=e[2],o=Math.cos,i=Math.sin,l=o(t/2),a=o(n/2),c=o(r/2),s=i(t/2),u=i(n/2),m=i(r/2);return[l*a*c-s*u*m,s*a*c+l*u*m,l*u*c-s*a*m,l*a*m+s*u*c]},G=function(e){return[e[0],-e[1],-e[2],-e[3]]},D=function(e,t,n){var r=e[0],o=e.slice(1),i=O(o.map((function(e,o){var i=2*Math.atan(e/r),l=A(i,t[o],n[o]);return Math.tan(.5*l)})));return function(e){var t=Math.hypot.apply(Math,e);return 0===t?[1,0,0,0]:[e[0]/t,e[1]/t,e[2]/t,e[3]/t]}([1,i[0],i[1],i[2]])},I=function(e,t,n){for(var r=new Array(2),o=0;o<2;o++){var i=e[o],l=t[o];r[o]=n(i,l)}return N(r)},F=function(e){return Math.pow(function(e){return Math.pow(e[0],2)+Math.pow(e[1],2)}(e),.5)},L=function(e,t){var n=I(e,t,(function(e,t){return e-t}));return F(n)},N=function(e){if(2!==e.length)throw new Error("Cannot create V2 from "+e+", length is "+e.length+". Length should be 2");return e},q=function(e,t){return r=t,o=(n=[e,0])[0],i=n[1],l=Math.cos(r),a=Math.sin(r),[o*l-i*a,o*a+i*l];var n,r,o,i,l,a};function W(e,t,n){var r=function(e,t){return H(e,t).effectorPosition}(e,t);return L(n,r)}function H(e,t){for(var n,r,o,i=[t],l=0;l<e.length;l++){var a=e[l],c=i[l],s=(null!==(n=a.rotation)&&void 0!==n?n:0)+c.rotation,u=q(a.length,s),m=(r=u,o=c.position,I(r,o,(function(e,t){return e+t})));i.push({position:m,rotation:s})}return{transforms:i,effectorPosition:i[i.length-1].position}}function V(e){var t=e.rotation,n=e.length,r=e.constraint;return{rotation:t,length:n,constraint:void 0===r?void 0:r}}var J=function(){return(J=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function T(e,t,n){var r=function(e,t){return X(e,t).effectorPosition}(e,t);return R(n,r)}function X(e,t){for(var n,r,o,i=[J({},t)],l=0;l<e.length;l++){var a=e[l],c=i[l],s=C(c.rotation,null!==(n=a.rotation)&&void 0!==n?n:[1,0,0,0]),u=S(a.length,s),m=(r=u,o=c.position,[r[0]+o[0],r[1]+o[1],r[2]+o[2]]);i.push({position:m,rotation:s})}return{transforms:i,effectorPosition:i[i.length-1].position}}function Y(e){var t=e.rotation,n=e.length,r=e.constraints;return{rotation:t,length:n,constraints:void 0===r?void 0:$(r)}}function $(e){var t=e.pitch,n=e.yaw,r=e.roll,o={};return"number"==typeof t?o.pitch=t:void 0!==typeof t&&(o.pitch=J({},t)),"number"==typeof n?o.yaw=n:void 0!==typeof n&&(o.yaw=J({},n)),"number"==typeof r?o.roll=r:void 0!==typeof r&&(o.roll=J({},r)),o}const z=(e,t)=>{const n=s.exports.useRef(),r=s.exports.useRef(),o=s.exports.useCallback((async i=>{void 0===r.current&&(r.current=i);const l=i-r.current;l>1e3/e&&(await t(l),r.current=i),n.current=requestAnimationFrame(o)}),[t,e]);s.exports.useEffect((()=>(n.current=requestAnimationFrame(o),()=>{n.current&&cancelAnimationFrame(n.current)})),[o])},K=({link:e,child:t})=>{const n=s.exports.useRef(),r=s.exports.useRef();u((()=>{n.current&&r.current&&(n.current.quaternion.set(e.rotation[1],e.rotation[2],e.rotation[3],e.rotation[0]),r.current.position.set(e.length,0,0))}));const o=s.exports.useMemo((()=>{const t=[new m,new m(e.length,0,0)],n=(new f).setFromPoints(t),r=new h({color:new p("#8B008B")});return new d(n,r)}),[e.length]);return g.createElement("group",{ref:n},g.createElement("mesh",{ref:r},g.createElement("sphereBufferGeometry",{args:[20,8,8]}),g.createElement("meshStandardMaterial",{transparent:!0,wireframe:!0}),t&&g.createElement(K,a({},t))),g.createElement("primitive",{object:o}))},Q=({base:e,links:t})=>{const n=s.exports.useRef(),r=s.exports.useMemo((()=>function(e){var t;let n;for(let r=e.length-1;r>=0;r--){const o={link:c(a({},e[r]),{rotation:null!=(t=e[r].rotation)?t:[1,0,0,0]})};void 0!==n?n={link:o.link,child:n}:n=o}return n}(t)),[t]);return u((()=>{var o;if(!n.current)return;n.current.position.set(...e.position),n.current.quaternion.set(e.rotation[1],e.rotation[2],e.rotation[3],e.rotation[0]);let i=0,l=r;for(;void 0!==l&&void 0!==t[i];)l.link.rotation=null!=(o=t[i].rotation)?o:[1,0,0,0],i++,l=l.child})),g.createElement("mesh",{ref:n},g.createElement("boxBufferGeometry",{args:[50,50]}),g.createElement("meshNormalMaterial",null),r&&g.createElement(K,a({},r)))};const U=({links:e,base:t})=>{const n=s.exports.useRef();u((()=>{var r;if(void 0===n.current)return;const{transforms:o}=X(e,t);for(let e=0;e<n.current.children.length;e++){const t=n.current.children[e],i=null==(r=o[e])?void 0:r.position;if(void 0===i)throw new Error(`No corresponding child position for index ${e}`);t.position.set(...i)}}));const r=s.exports.useMemo((()=>Array.from({length:e.length+1}).map(((e,t)=>g.createElement("mesh",{key:t},g.createElement("boxBufferGeometry",{args:[12.5,12.5,12.5]}),g.createElement("meshBasicMaterial",{color:"red"}))))),[e.length]);return g.createElement("group",{ref:n},r)},Z=({target:e,links:t,base:n})=>{const r=s.exports.useRef(null);return z(1,(()=>{r.current&&(r.current.innerText=T(t,n,e).toFixed(3))})),g.createElement("div",{style:{position:"absolute",top:0,left:0,userSelect:"none"}},g.createElement("table",null,g.createElement("tbody",null,g.createElement("tr",null,g.createElement("td",null,"Distance"),g.createElement("td",{ref:r})))))},_=({position:e})=>g.createElement("mesh",{scale:[50,50,1],position:[...e]},g.createElement("boxBufferGeometry",null),g.createElement("meshBasicMaterial",{color:"hotpink"})),ee={position:[0,0,0],rotation:[1,0,0,0]};function te(){const[e,t]=s.exports.useState([500,50,0]),[n,r]=s.exports.useState([]),{linkCount:o,linkLength:i,linkMinAngle:l,linkMaxAngle:a}=v({linkCount:{value:4,min:0,max:50,step:1},linkLength:{value:200,min:1,max:200,step:10},linkMinAngle:{value:-90,min:-360,max:0,step:10},linkMaxAngle:{value:90,min:0,max:360,step:10}});return s.exports.useEffect((()=>{r(ne(o,i,l,a))}),[o,i,l,a]),z(60,(()=>{const t=o*i;const r=function(e,t,n,r){var o,i,l,a=null!==(o=null==r?void 0:r.deltaAngle)&&void 0!==o?o:1e-5,c=null!==(i=null==r?void 0:r.learningRate)&&void 0!==i?i:1e-4,s=null!==(l=null==r?void 0:r.acceptedError)&&void 0!==l?l:0,u=X(e,t),m=u.transforms,f=u.effectorPosition,h=R(n,f);if(h<s)return{links:e.map(Y),isWithinAcceptedError:!0,getErrorDistance:function(){return h}};if(m.length!==e.length+1)throw new Error("Joint transforms should have the same length as links + 1. Got "+m.length+", expected "+e.length);var p=e.map((function(t,r){var o=t.length,i=t.rotation,l=void 0===i?[1,0,0,0]:i,s=t.constraints,u=O([0,0,0].map((function(t,i){var s=[0,0,0];s[i]=a;var u=T(function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([{length:o,rotation:C(l,j(O(s)))}],e.slice(r+1)),m[r],n);return-(u-h)/a*("function"==typeof c?c(u):c)})));return{link:{length:o,rotation:l,constraints:s},angleStep:j(u)}})).map((function(e){var t,n,r,o,i,l,a=e.link,c=a.length,s=a.rotation,u=a.constraints,m=e.angleStep,f=C(s,m);if(void 0===u)return{length:c,rotation:f};var h,p,d,g,v,E,x=u.pitch,k=u.yaw,b=u.roll;return"number"==typeof x?(h=-x/2,p=x/2):(h=null!==(t=null==x?void 0:x.min)&&void 0!==t?t:1/0,p=null!==(n=null==x?void 0:x.max)&&void 0!==n?n:1/0),"number"==typeof k?(d=-k/2,g=k/2):(d=null!==(r=null==k?void 0:k.min)&&void 0!==r?r:1/0,g=null!==(o=null==k?void 0:k.max)&&void 0!==o?o:1/0),"number"==typeof b?(v=-b/2,E=b/2):(v=null!==(i=null==b?void 0:b.min)&&void 0!==i?i:1/0,E=null!==(l=null==b?void 0:b.max)&&void 0!==l?l:1/0),{length:c,rotation:D(f,[h,d,v],[p,g,E]),constraints:$(u)}}));return{links:p,getErrorDistance:function(){return T(p,t,n)},isWithinAcceptedError:void 0}}(n,ee,e,{learningRate:function(e){const n=A(e/t,0,1);return n>.1?1e-5:1e-6+1e-6*(n/.02)},acceptedError:10}).links;n.forEach(((e,t)=>{n[t]=r[t]}))})),g.createElement("div",{onClick:e=>{const n=[e.clientX-window.innerWidth/2,-e.clientY+window.innerHeight/2,100*Math.random()];t(n)}},g.createElement(E,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},linear:!0},g.createElement(x,null),g.createElement("group",{scale:[.005,.005,.005]},g.createElement(Q,{base:ee,links:n}),g.createElement(U,{links:n,base:ee}),g.createElement(_,{position:e}))),g.createElement(Z,{target:e,links:n,base:ee}))}const ne=(e,t,n,r)=>Array.from({length:e}).map((()=>({length:t,constraint:{min:n*Math.PI/180,max:r*Math.PI/180}}))),re=({link:e,child:t})=>{const n=s.exports.useRef(),r=s.exports.useRef();u((()=>{n.current&&r.current&&(n.current.rotation.set(0,0,e.rotation),r.current.position.set(e.length,0,0))}));const o=s.exports.useMemo((()=>{const t=[new m,new m(e.length,0,0)],n=(new f).setFromPoints(t),r=new h({color:new p("#8B008B")});return new d(n,r)}),[e.length]);return g.createElement("group",{ref:n},g.createElement("mesh",{ref:r},g.createElement("sphereBufferGeometry",{args:[20,100,100]}),g.createElement("meshNormalMaterial",null),t&&g.createElement(re,a({},t))),g.createElement("primitive",{object:o}))},oe=({base:e,links:t})=>{const n=s.exports.useRef(),r=s.exports.useMemo((()=>function(e){var t;let n;for(let r=e.length-1;r>=0;r--){const o={link:c(a({},e[r]),{rotation:null!=(t=e[r].rotation)?t:0})};void 0!==n?n={link:o.link,child:n}:n=o}return n}(t)),[t]);return u((()=>{var o;if(!n.current)return;n.current.position.set(...e.position,0),n.current.rotation.set(0,0,e.rotation);let i=0,l=r;for(;void 0!==l&&void 0!==t[i];)l.link.rotation=null!=(o=t[i].rotation)?o:0,i++,l=l.child})),g.createElement("mesh",{ref:n},g.createElement("boxBufferGeometry",{args:[50,50]}),g.createElement("meshNormalMaterial",null),r&&g.createElement(re,a({},r)))};const ie=({links:e,base:t})=>{const n=s.exports.useRef();u((()=>{var r;if(void 0===n.current)return;const{transforms:o}=H(e,t);for(let e=0;e<n.current.children.length;e++){const t=n.current.children[e],i=null==(r=o[e])?void 0:r.position;if(void 0===i)throw new Error(`No corresponding child position for index ${e}`);t.position.set(...i,100)}}));const r=s.exports.useMemo((()=>Array.from({length:e.length+1}).map(((e,t)=>g.createElement("mesh",{key:t},g.createElement("boxBufferGeometry",{args:[12.5,12.5]}),g.createElement("meshBasicMaterial",{color:"red"}))))),[e]);return g.createElement("group",{ref:n},r)},le=({target:e,links:t,base:n})=>{const r=s.exports.useRef(null);return z(1,(()=>{r.current&&(r.current.innerText=W(t,n,e).toFixed(3))})),g.createElement("div",{style:{position:"absolute",top:0,left:0,userSelect:"none"}},g.createElement("table",null,g.createElement("tbody",null,g.createElement("tr",null,g.createElement("td",null,"Distance"),g.createElement("td",{ref:r})))))},ae=({position:e})=>g.createElement("mesh",{scale:[50,50,1],position:[...e,-1]},g.createElement("boxBufferGeometry",null),g.createElement("meshBasicMaterial",{color:"hotpink"})),ce={position:[0,0],rotation:0};function se(){const[e,t]=s.exports.useState([500,50]),[n,r]=s.exports.useState([]),{linkCount:o,linkLength:i,linkMinAngle:l,linkMaxAngle:a}=v({linkCount:{value:4,min:0,max:50,step:1},linkLength:{value:200,min:1,max:200,step:10},linkMinAngle:{value:-90,min:-360,max:0,step:10},linkMaxAngle:{value:90,min:0,max:360,step:10}});return s.exports.useEffect((()=>{r(ue(o,i,l,a))}),[o,i,l,a]),z(60,(()=>{const t=o*i;const r=function(e,t,n,r){var o,i,l,a=null!==(o=null==r?void 0:r.deltaAngle)&&void 0!==o?o:1e-5,c=null!==(i=null==r?void 0:r.learningRate)&&void 0!==i?i:1e-4,s=null!==(l=null==r?void 0:r.acceptedError)&&void 0!==l?l:0,u=H(e,t),m=u.transforms,f=u.effectorPosition,h=L(n,f);if(h<s)return{links:e.map(V),isWithinAcceptedError:!0,getErrorDistance:function(){return h}};if(m.length!==e.length+1)throw new Error("Joint transforms should have the same length as links + 1. Got "+m.length+", expected "+e.length);var p=e.map((function(t,r){var o=t.rotation,i=void 0===o?0:o,l=t.length,s=t.constraint,u=W(function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([{length:l,rotation:i+a}],e.slice(r+1)),m[r],n);return{link:{rotation:i,length:l,constraint:s},angleStep:-(u-h)/a*("function"==typeof c?c(u):c)}})).map((function(e){var t=e.link,n=t.length,r=t.rotation,o=t.constraint,i=r+e.angleStep;if(void 0===o)return{length:n,rotation:i};if("number"==typeof o){var l=o/2;return{length:n,rotation:A(i,-l,l),constraint:o}}return{length:n,rotation:A(i,o.min,o.max),constraint:o}}));return{links:p,getErrorDistance:function(){return W(p,t,n)},isWithinAcceptedError:void 0}}(n,ce,e,{learningRate:function(e){const n=A(e/t,0,1);return n>.1?1e-5:1e-6+1e-6*(n/.02)},acceptedError:10}).links;n.forEach(((e,t)=>{n[t]=r[t]}))})),g.createElement("div",{onClick:({clientX:e,clientY:n})=>t([e-window.innerWidth/2,-n+window.innerHeight/2])},g.createElement(E,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},orthographic:!0,linear:!0,camera:{near:-1e3}},g.createElement(ie,{links:n,base:ce}),g.createElement(oe,{base:ce,links:n}),g.createElement(ae,{position:e})),g.createElement(le,{target:e,links:n,base:ce}))}const ue=(e,t,n,r)=>Array.from({length:e}).map((()=>({length:t,constraint:{min:n*Math.PI/180,max:r*Math.PI/180}})));function me(){return g.createElement(k,{basename:"/"},g.createElement(fe,null),g.createElement(b,{path:"/2d"},g.createElement(se,null)),g.createElement(b,{exact:!0,path:"/"},g.createElement(se,null)),g.createElement(b,{path:"/3d"},g.createElement(te,null)))}function fe(){const e=y().pathname;return g.createElement("div",{style:{position:"absolute",zIndex:10}},g.createElement("h2",null,"Inverse kinematics examples"),g.createElement("ul",null,g.createElement("li",{className:"/2d"===e?"highlighted":""},g.createElement(w,{to:"/2d"},"2D example")),g.createElement("li",{className:"/3d"===e?"highlighted":""},g.createElement(w,{to:"/3d"},"3D example")),g.createElement("li",null,g.createElement("a",{href:"https://github.com/tmf-code/inverse-kinematics"},"Github page"))))}M.render(g.createElement(g.StrictMode,null,g.createElement(me,null)),document.getElementById("root"));

var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,i=(e,i)=>{for(var a in i||(i={}))n.call(i,a)&&o(e,a,i[a]);if(t)for(var a of t(i))r.call(i,a)&&o(e,a,i[a]);return e};import{r as a,u as l,V as c,B as s,L as u,C as m,a as f,R as h,b as p,O as d,H as g,c as v,d as E,e as y}from"./vendor.6a5ea322.js";var b=function(e,t,n){return Math.min(Math.max(t,e),n)},w=function(e){return e[0]+e[1]+e[2]},x=function(e){return Math.pow(function(e){return w((n=e,[(t=e)[0]*n[0],t[1]*n[1],t[2]*n[2]]));var t,n}(e),.5)},k=function(e,t){var n,r,o=(r=t,[(n=e)[0]-r[0],n[1]-r[1],n[2]-r[2]]);return x(o)},M=function(e){if(3!==e.length)throw new Error("Cannot create V3 from "+e+", length is "+e.length+". Length should be 3");return e},P=function(e,t){return n=[e,0,0],o=A(r=t),i=R(r,function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([0],n)),R(i,o).slice(1);var n,r,o,i},R=function(e,t){var n=e[1],r=e[2],o=e[3],i=e[0],a=t[1],l=t[2],c=t[3],s=t[0];return[i*s-n*a-r*l-o*c,n*s+i*a+r*c-o*l,r*s+i*l+o*a-n*c,o*s+i*c+n*l-r*a]},B=function(e){var t=e[0],n=e[1],r=e[2],o=Math.cos,i=Math.sin,a=o(t/2),l=o(n/2),c=o(r/2),s=i(t/2),u=i(n/2),m=i(r/2);return[a*l*c-s*u*m,s*l*c+a*u*m,a*u*c-s*l*m,a*l*m+s*u*c]},A=function(e){return[e[0],-e[1],-e[2],-e[3]]},G=function(e,t,n){var r=e[0],o=e.slice(1),i=M(o.map((function(e,o){var i=2*Math.atan(e/r),a=b(i,t[o],n[o]);return Math.tan(.5*a)})));return function(e){var t=Math.hypot.apply(Math,e);return 0===t?[1,0,0,0]:[e[0]/t,e[1]/t,e[2]/t,e[3]/t]}([1,i[0],i[1],i[2]])},I=function(e,t,n){for(var r=new Array(2),o=0;o<2;o++){var i=e[o],a=t[o];r[o]=n(i,a)}return O(r)},S=function(e){return Math.pow(function(e){return Math.pow(e[0],2)+Math.pow(e[1],2)}(e),.5)},D=function(e,t){var n=I(e,t,(function(e,t){return e-t}));return S(n)},O=function(e){if(2!==e.length)throw new Error("Cannot create V2 from "+e+", length is "+e.length+". Length should be 2");return e},j=function(e,t){return r=t,o=(n=[e,0])[0],i=n[1],a=Math.cos(r),l=Math.sin(r),[o*a-i*l,o*l+i*a];var n,r,o,i,a,l};function C(e,t,n){var r=function(e,t){return F(e,t).effectorPosition}(e,t);return D(n,r)}function F(e,t){for(var n,r,o=[t],i=0;i<e.length;i++){var a=e[i],l=o[i],c=a.rotation+l.rotation,s=j(a.length,c),u=(n=s,r=l.position,I(n,r,(function(e,t){return e+t})));o.push({position:u,rotation:c})}return{transforms:o,effectorPosition:o[o.length-1].position}}function W(e){var t=e.rotation,n=e.length,r=e.constraint;return{rotation:t,length:n,constraint:void 0===r?void 0:r}}var q=function(){return(q=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function N(e,t,n){var r=function(e,t){return H(e,t).effectorPosition}(e,t);return k(n,r)}function H(e,t){for(var n,r,o=[q({},t)],i=0;i<e.length;i++){var a=e[i],l=o[i],c=R(l.rotation,a.rotation),s=P(a.length,c),u=(n=s,r=l.position,[n[0]+r[0],n[1]+r[1],n[2]+r[2]]);o.push({position:u,rotation:c})}return{transforms:o,effectorPosition:o[o.length-1].position}}function L(e){var t=e.rotation,n=e.length,r=e.constraints;return{rotation:t,length:n,constraints:void 0===r?void 0:V(r)}}function V(e){var t=e.pitch,n=e.yaw,r=e.roll,o={};return"number"==typeof t?o.pitch=t:void 0!==typeof t&&(o.pitch=q({},t)),"number"==typeof n?o.yaw=n:void 0!==typeof n&&(o.yaw=q({},n)),"number"==typeof r?o.roll=r:void 0!==typeof r&&(o.roll=q({},r)),o}const J=({link:e,child:t})=>{const n=a.exports.useRef(),r=a.exports.useRef();l((()=>{n.current&&r.current&&(n.current.quaternion.set(e.rotation[1],e.rotation[2],e.rotation[3],e.rotation[0]),r.current.position.set(e.length,0,0))}));const o=a.exports.useMemo((()=>{const t=[new c,new c(e.length,0,0)],n=(new s).setFromPoints(t),r=new u({color:new m("#8B008B")});return new f(n,r)}),[e.length]);return h.createElement("group",{ref:n},h.createElement("mesh",{ref:r},h.createElement("sphereBufferGeometry",{args:[20,8,8]}),h.createElement("meshStandardMaterial",{transparent:!0,wireframe:!0}),t&&h.createElement(J,i({},t))),h.createElement("primitive",{object:o}))},T=({position:e,links:t,target:n})=>{const r=a.exports.useRef(),o=a.exports.useRef(t),c=a.exports.useMemo((()=>function(e){let t;for(let n=e.length-1;n>=0;n--){const r={link:e[n]};void 0!==t?t={link:r.link,child:t}:t=r}return t}(t)),[t]);return l((()=>{if(!r.current)return;r.current.position.set(...e),o.current=function(e,t,n,r){var o,i,a,l=null!==(o=null==r?void 0:r.deltaAngle)&&void 0!==o?o:1e-5,c=null!==(i=null==r?void 0:r.learningRate)&&void 0!==i?i:1e-4,s=null!==(a=null==r?void 0:r.acceptedError)&&void 0!==a?a:0,u=H(e,{position:t,rotation:[1,0,0,0]}),m=u.transforms,f=u.effectorPosition,h=k(n,f);if(h<s)return{links:e.map(L),isWithinAcceptedError:!0,getErrorDistance:function(){return h}};if(m.length!==e.length+1)throw new Error("Joint transforms should have the same length as links + 1. Got "+m.length+", expected "+e.length);var p=e.map((function(t,r){var o=M([0,0,0].map((function(o,i){var a=[0,0,0];a[i]=l;var s=N(function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([{length:t.length,rotation:R(t.rotation,B(M(a)))}],e.slice(r+1)),m[r],n);return-(s-h)/l*("function"==typeof c?c(s):c)})));return{link:t,angleStep:B(o)}})).map((function(e){var t,n,r,o,i,a,l=e.link,c=l.length,s=l.rotation,u=l.constraints,m=e.angleStep,f=R(s,m);if(void 0===u)return{length:c,rotation:f};var h,p,d,g,v,E,y=u.pitch,b=u.yaw,w=u.roll;return"number"==typeof y?(h=-y/2,p=y/2):(h=null!==(t=null==y?void 0:y.min)&&void 0!==t?t:1/0,p=null!==(n=null==y?void 0:y.max)&&void 0!==n?n:1/0),"number"==typeof b?(d=-b/2,g=b/2):(d=null!==(r=null==b?void 0:b.min)&&void 0!==r?r:1/0,g=null!==(o=null==b?void 0:b.max)&&void 0!==o?o:1/0),"number"==typeof w?(v=-w/2,E=w/2):(v=null!==(i=null==w?void 0:w.min)&&void 0!==i?i:1/0,E=null!==(a=null==w?void 0:w.max)&&void 0!==a?a:1/0),{length:c,rotation:G(f,[h,d,v],[p,g,E]),constraints:V(u)}}));return{links:p,getErrorDistance:function(){return N(p,{position:t,rotation:[1,0,0,0]},n)},isWithinAcceptedError:void 0}}(o.current,e,n,{acceptedError:10,learningRate:X}).links;let t=0,i=c;for(;void 0!==i&&void 0!==o.current[t];)i.link.rotation=o.current[t].rotation,t++,i=i.child})),h.createElement("mesh",{ref:r},h.createElement("boxBufferGeometry",{args:[50,50]}),h.createElement("meshNormalMaterial",null),c&&h.createElement(J,i({},c)))};function X(e){const t=b(e/230,0,1);if(t>.1)return 1e-4;return 1e-5+1e-5*(t/.02)}const Y=({links:e,basePosition:t})=>{const n=a.exports.useRef();return l((()=>{var r;if(void 0===n.current)return;const{transforms:o}=H(e,{position:t,rotation:[1,0,0,0]});for(let e=0;e<n.current.children.length;e++){const t=n.current.children[e],i=null==(r=o[e])?void 0:r.position;if(void 0===i)throw new Error(`No corresponding child position for index ${e}`);t.position.set(...i)}})),h.createElement("group",{ref:n},Array.from({length:e.length+1}).map(((e,t)=>h.createElement("mesh",{key:t},h.createElement("boxBufferGeometry",{args:[12.5,12.5,12.5]}),h.createElement("meshBasicMaterial",{color:"red"})))))},$=(e,t)=>{const n=a.exports.useRef(),r=a.exports.useRef(),o=a.exports.useCallback((async i=>{void 0===r.current&&(r.current=i);const a=i-r.current;a>1e3/e&&(await t(a),r.current=i),n.current=requestAnimationFrame(o)}),[t,e]);a.exports.useEffect((()=>(n.current=requestAnimationFrame(o),()=>{n.current&&cancelAnimationFrame(n.current)})),[o])},z=({target:e,links:t,basePosition:n})=>{const r=a.exports.useRef(null);return $(1,(()=>{r.current&&(r.current.innerText=N(t,{position:n,rotation:[1,0,0,0]},e).toFixed(3))})),h.createElement("div",{style:{position:"absolute",top:0,left:0,userSelect:"none"}},h.createElement("table",null,h.createElement("tbody",null,h.createElement("tr",null,h.createElement("td",null,"Distance"),h.createElement("td",{ref:r})))))},K=({position:e})=>h.createElement("mesh",{scale:[50,50,1],position:[...e]},h.createElement("boxBufferGeometry",null),h.createElement("meshBasicMaterial",{color:"hotpink"})),Q=[{length:80,rotation:[1,0,0,0],constraints:{roll:0,yaw:Math.PI,pitch:1.1*Math.PI}},{length:100,rotation:[1,0,0,0],constraints:{roll:Math.PI/2,yaw:{min:-5*Math.PI/6,max:0},pitch:0}},{length:30,rotation:[1,0,0,0],constraints:{roll:0,yaw:0,pitch:3*Math.PI/2}}],U=[0,0,0];function Z(){const[e,t]=a.exports.useState([500,50,0]);return h.createElement("div",{onClick:e=>{const n=[e.clientX-window.innerWidth/2,-e.clientY+window.innerHeight/2,100*Math.random()];t(n)}},h.createElement(p,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},linear:!0},h.createElement(d,null),h.createElement("group",{scale:[.005,.005,.005]},h.createElement(T,{position:U,links:Q,target:e}),h.createElement(Y,{links:Q,basePosition:U}),h.createElement(K,{position:e}))),h.createElement(z,{target:e,links:Q,basePosition:U}))}const _=({link:e,child:t})=>{const n=a.exports.useRef(),r=a.exports.useRef();l((()=>{n.current&&r.current&&(n.current.rotation.set(0,0,e.rotation),r.current.position.set(e.length,0,0))}));const o=a.exports.useMemo((()=>{const t=[new c,new c(e.length,0,0)],n=(new s).setFromPoints(t),r=new u({color:new m("#8B008B")});return new f(n,r)}),[e.length]);return h.createElement("group",{ref:n},h.createElement("mesh",{ref:r},h.createElement("sphereBufferGeometry",{args:[20,100,100]}),h.createElement("meshNormalMaterial",null),t&&h.createElement(_,i({},t))),h.createElement("primitive",{object:o}))},ee=({position:e,links:t,target:n})=>{const r=a.exports.useRef(),o=a.exports.useRef(t),c=a.exports.useMemo((()=>function(e){let t;for(let n=e.length-1;n>=0;n--){const r={link:e[n]};void 0!==t?t={link:r.link,child:t}:t=r}return t}(t)),[t]);return l((()=>{if(!r.current)return;r.current.position.set(...e,0),o.current=function(e,t,n,r){var o,i,a,l=null!==(o=null==r?void 0:r.deltaAngle)&&void 0!==o?o:1e-5,c=null!==(i=null==r?void 0:r.learningRate)&&void 0!==i?i:1e-4,s=null!==(a=null==r?void 0:r.acceptedError)&&void 0!==a?a:0,u=F(e,{position:t,rotation:0}),m=u.transforms,f=u.effectorPosition,h=D(n,f);if(h<s)return{links:e.map(W),isWithinAcceptedError:!0,getErrorDistance:function(){return h}};if(m.length!==e.length+1)throw new Error("Joint transforms should have the same length as links + 1. Got "+m.length+", expected "+e.length);var p=e.map((function(t,r){var o=C(function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}([{length:t.length,rotation:t.rotation+l}],e.slice(r+1)),m[r],n);return{link:t,angleStep:-(o-h)/l*("function"==typeof c?c(o):c)}})).map((function(e){var t=e.link,n=t.length,r=t.rotation,o=t.constraint,i=r+e.angleStep;if(void 0===o)return{length:n,rotation:i};if("number"==typeof o){var a=o/2;return{length:n,rotation:b(i,-a,a),constraint:o}}return{length:n,rotation:b(i,o.min,o.max),constraint:o}}));return{links:p,getErrorDistance:function(){return C(p,{position:t,rotation:0},n)},isWithinAcceptedError:void 0}}(t,e,n,{learningRate:te,acceptedError:10}).links;let i=0,a=c;for(;void 0!==a&&void 0!==o.current[i];)a.link.rotation=o.current[i].rotation,i++,a=a.child})),h.createElement("mesh",{ref:r},h.createElement("boxBufferGeometry",{args:[50,50]}),h.createElement("meshNormalMaterial",null),c&&h.createElement(_,i({},c)))};function te(e){const t=b(e/230,0,1);if(t>.1)return 1e-4;return 1e-5+1e-5*(t/.02)}const ne=({links:e,basePosition:t})=>{const n=a.exports.useRef();return l((()=>{var r;if(void 0===n.current)return;const{transforms:o}=F(e,{position:t,rotation:0});for(let e=0;e<n.current.children.length;e++){const t=n.current.children[e],i=null==(r=o[e])?void 0:r.position;if(void 0===i)throw new Error(`No corresponding child position for index ${e}`);t.position.set(...i,100)}})),h.createElement("group",{ref:n},Array.from({length:e.length+1}).map(((e,t)=>h.createElement("mesh",{key:t},h.createElement("boxBufferGeometry",{args:[12.5,12.5]}),h.createElement("meshBasicMaterial",{color:"red"})))))},re=({target:e,links:t,basePosition:n})=>{const r=a.exports.useRef(null);return $(1,(()=>{r.current&&(r.current.innerText=C(t,{position:n,rotation:0},e).toFixed(3))})),h.createElement("div",{style:{position:"absolute",top:0,left:0,userSelect:"none"}},h.createElement("table",null,h.createElement("tbody",null,h.createElement("tr",null,h.createElement("td",null,"Distance"),h.createElement("td",{ref:r})))))},oe=({position:e})=>h.createElement("mesh",{scale:[50,50,1],position:[...e,-1]},h.createElement("boxBufferGeometry",null),h.createElement("meshBasicMaterial",{color:"hotpink"})),ie=[{rotation:0,length:50},{rotation:0,constraint:{min:0,max:Math.PI/2},length:200},{rotation:0,constraint:{min:0,max:Math.PI/2},length:200},{rotation:0,constraint:{min:0,max:Math.PI/2},length:200}],ae=[0,0];function le(){const[e,t]=a.exports.useState([500,50]);return h.createElement("div",{onClick:e=>{const n=[e.clientX-window.innerWidth/2,-e.clientY+window.innerHeight/2];t(n)}},h.createElement(p,{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"aquamarine"},orthographic:!0,linear:!0,camera:{near:-1e3}},h.createElement(ee,{position:ae,links:ie,target:e}),h.createElement(ne,{links:ie,basePosition:ae}),h.createElement(oe,{position:e})),h.createElement(re,{target:e,links:ie,basePosition:ae}))}function ce(){return h.createElement(g,{basename:"/"},h.createElement(se,null),h.createElement(v,{path:"/2d"},h.createElement(le,null)),h.createElement(v,{path:"/3d"},h.createElement(Z,null)))}function se(){return h.createElement("div",{style:{position:"absolute",zIndex:10}},h.createElement("ul",null,h.createElement("li",null,h.createElement("a",{href:"https://github.com/tmf-code/inverse-kinematics"},"Github page")),h.createElement("li",null,h.createElement(E,{to:"/2d"},"2D Demo")),h.createElement("li",null,h.createElement(E,{to:"/3d"},"3D Demo"))))}y.render(h.createElement(h.StrictMode,null,h.createElement(ce,null)),document.getElementById("root"));
